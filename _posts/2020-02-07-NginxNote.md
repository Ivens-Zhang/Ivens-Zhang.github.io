---
layout: post
title: "Nginx 学习笔记"
subtitle: ''
author: "Ivens"
header-mask: 0.2
header-img: "img/in-post/2020-01-22/a.jpg"
catalog: true
tags:
  - 运维
---

## 一. Nginx 简介

### 1. Nginx 概述

> Nginx ("engine x") 是一个高性能的 HTTP 和反向代理服务器,特点是占有内存少，并发能
> 力强，事实上 nginx 的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用 nginx
> 网站用户有：**百度、京东、新浪、网易、腾讯、淘宝等**

Nginx 专为性能优化而开发， 性能是其最重要的考量, 实现上非常注重效率 ，能经受高负载的考验,有报告表明能支持高 达 `50,000` 个并发连接数。

### 2. Nginx 的四大特点

1. 反向代理
2. 负载均衡
3. 动静分离
4. 高可用

### 3. 反向代理

说反向代理前必须弄清楚正向代理是什么意思:

> 正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访 问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。

<img src="https://raw.githubusercontent.com/Ivens-Zhang/PictureBed-2019.12.9/master/img/20200207181236.png" style="zoom:67%;" />

举个形象点的例子: 

> A同学想创业，目前他遇到的最大的一个问题就是启动资金，于是他决定去找马云爸爸借钱，可想而知，最后碰一鼻子灰回来了。
>
> 情急之下，他想到一个办法，找关系开后门，经过一番消息打探，原来A同学的大学老师王老师是马云的同学，于是A同学找到王老师，托王老师帮忙去马云那借500万过来，当然最后事成了。
>
> 不过马云并不知道这钱是A同学借的，马云是借给王老师的，最后由王老师转交给A同学。这里的王老师在这个过程中扮演了一个非常关键的角色，就是**代理**，也可以说是正向代理，王老师代替A同学办这件事，这个过程中，真正借钱的人是谁，马云是不知道的，这点非常关键。

我们常说的代理也就是只正向代理，正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求，科学上网工具 `Shadowsocks` 扮演的就是典型的正向代理角色。

在中国访问 www.google.com 时会被无情的墙掉，要想翻越这堵墙，你可以在国外用 `Shadowsocks` 来搭建一台代理服务器，代理帮我们请求 www.google.com，代理再把请求响应结果再返回给我。

---

介绍完正向代理, 现在我们再来看看反向代理是什么?

> 反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只 需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返 回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器 地址，隐藏了真实服务器 IP 地址。

<img src="https://raw.githubusercontent.com/Ivens-Zhang/PictureBed-2019.12.9/master/img/20200207182221.png" style="zoom: 67%;" />

反向代理隐藏了真实的服务端，当我们访问 www.baidu.com 的时候，就像拨打 10086 一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到提供真实计算的服务器那里去。

### 4. 负载均衡

客户端发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行交互，服 务器处理完毕后，再将结果返回给客户端。 

这种架构模式对于早期的系统相对单一，并发请求相对较少的情况下是比较适合的，成本也低。但是随着信息数量的不断增长，访问量和数据量的飞速增长，以及系统业务的复杂 度增加，这种架构会造成服务器相应客户端的请求日益缓慢，并发量特别大的时候，还容易 造成服务器直接崩溃。很明显这是由于服务器性能的瓶颈造成的问题，那么如何解决这种情况呢？

这时候**集群**的概念产生了，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡.

<img src="https://raw.githubusercontent.com/Ivens-Zhang/PictureBed-2019.12.9/master/img/20200207183346.png" style="zoom:67%;" />

> 增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的 情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡

### 5. 动静分离

> 为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度。降低原来单个服务器的压力。

<img src="https://raw.githubusercontent.com/Ivens-Zhang/PictureBed-2019.12.9/master/img/20200207182719.png" style="zoom:67%;" />

### 6. 高可用

当我们搭建好服务器后, 总会担心会不会那一天我们的 Nginx 会宕机. 如果这样, 我们的网站就会无法访问. 解决的方法可以是: 既然一个 Nginx 会有几率宕机, 那我们就再增加一个 Nginx, 两个同时宕机的可能则会微乎其微了.

![](https://raw.githubusercontent.com/Ivens-Zhang/PictureBed-2019.12.9/master/img/20200207183830.png)

由于两个 Nginx 的 ip 地址不同, 我们需要给这两个 Nginx 设置一个相同的虚拟 ip.

当主 Nginx 出现宕机的问题时, `keeplived` 会自动切换到备用 Nginx 上继续工作.































