---
layout: post
title: "Node学习笔记（一）"
subtitle: ''
author: "Ivens"
header-mask: 0.2
header-img: "img/in-post/2020-01-22/a.jpg"
catalog: true
hidden: true
tags:
  - Node.js
---

## 一. Node.js 是什么?
> `Node.js®` 是一个基于 `Chrome V8` 引擎 的 `JavaScript` 运行环境。

- Node.js 不是语言
- Node.js 不是框架、不是库
- Node.js 可以解析和执行 JavaScript 代码

**所谓“运行环境”有两层意思：** 首先，JavaScript 语言通过 Node 在服务器运行，在这个意义上，Node有点像 **`JavaScript虚拟机`**；其次，Node 提供大量工具库，使得 JavaScript 语言与操作系统互动（比如读写文件、新建子进程），在这个意义上，Node又是 **`JavaScript的工具库`**。

*Node 内部采用 Google 司的V8引擎，作为 JavaScript 语言解释器；通过自行开发的 libuv 库，调用操作系统资源。*

现在的 JavaScript 可以脱离浏览器运行, 这归功于 Node.js

**与浏览器中 JavaScript 的区别?**
- 没有 DOM, 没有 BOM
- Node.js 提供了一些服务器级别的操作 API 
  - 例如文件读写
  - 网络通信, 等 ...

## 二. Node.js 能做什么?
- **Web 服务器后台**
- **命令行工具**
  - npm
  - Hexo
  - Webpack
  - Gulp
  - ......

## 三. Hello Node

创建 `helloNode.js` 文件, 写入:

```js
var foo = 'hello Node'
console.log(foo)
```
打开终端定位 js 文件所属目录, 输入 `node ./helloNode.js`, 终端会显示结果:
```cmd
PS F:\Software\Node.js\Node.js-Learning-Repository\src\2020-1-29> node .\helloNode.js

hello Node
```

## 四. 简单的文件 IO 操作

### 1. 读文件

```js
// 1. 使用 require 方法加载 fs 核心模块
var fs = require('fs')

// 2. 读取文件
fs.readFile('../../README.md', function (err, data) {
  // 如果回调函数成功, err 返回 null, data 返回二进制数据
  // 如果回调函数失败, err 返回 Error 对象, data 返回 null
  if (err) {
    console.log(err)
  } else {
    console.log(data.toString())
  }
})
```

### 2. 写文件

```js
// 1. 使用 require 方法加载 fs 核心模块
var fs = require('fs')

// 2. 写入文件
fs.writeFile('./write.txt', '这是用来写入的 txt 文件!', function (err) {
  // 如果回调函数成功, err 返回 null, 失败则返回 Error 对象.
  if (err) {
    console.log(error)
  } else {
    console.log('成功写入数据!')
  }
})
```

## 五. 简单的 HTTP 请求

```js
// 1. 加载 http 核心模块
var http = require('http')

// 2. 使用 http.createSever() 创建一个 Web 服务器
var server = http.createServer()

server.on('request', (request, response) => {
  // 3.1. 接收请求
  console.log('收到客户端请求!' + request.url)

  // 3.2. 发出响应, 根据 url(统一资源定位符) 不同分配不同响应
  switch (request.url) {
    // 如果访问 'http://127.0.0.1:3000/', 如下响应:
    case '/':
      response.write('Hello this page is index')
      response.end()
      break;
    
    // 如果访问 'http://127.0.0.1:3000/b', 响应信息也可以这样写, 等于上面的 write + end, 如下响应:
    case '/b':
      response.end('Hello this b page')
      break;
  
    // 如果访问 'http://127.0.0.1:3000/goods', 响应信息为 json 格式, 我们需要将它转换成 String 或 Buffer 类型写入响应.
    case '/goods':
      let goods = [
        {
          name: 'apple',
          price: 10
        },
        {
          name: 'banana',
          price: 5
        }
      ]
   // 如果要响应的信息包含中文字符, 需要设置响应头
   // response.setHeader('Content-Type', 'text/plain; charset = utf-8')
      response.end(JSON.stringify(goods))
      break;
      
    default:
      break;
  }
})

// 4. 侦听 3000 端口, 启动服务器
server.listen(3000, function () {  
  console.log('服务器启动成功!')
})

```

在命令行中启动 js 文件

```cmd
PS F:\Software\Node.js\Node.js-Learning-Repository\src\2020-1-29> node .\http.js
服务器启动成功!
```



**1. 访问地址:`http://127.0.0.1:3000/`, 终端显示结果:** 

```cmd
收到客户端请求!/
收到客户端请求!/favicon.ico
```

浏览器显示:

```html
Hello this page is index
```



**2. 访问地址: `http://127.0.0.1:3000/b`, 终端显示结果:**

```cmd
收到客户端请求!/b 
收到客户端请求!/favicon.ico
```

浏览器显示:

```
Hello this b page
```



**3. 访问 `http://127.0.0.1:3000/goods`, 终端显示结果:**

```cmd
收到客户端请求!/goods
收到客户端请求!/favicon.ico
```

浏览器显示:

```
[
    {
        "name": "apple",
        "price": 10
    },
    {
        "name": "banana",
        "price": 5
    }
]
```



我们通过一个简单的 `switch case` 语句, 为 http 请求增加了转发功能.

当我们需要发送响应数据是中文字符串的时候, 我们需要在设置响应头中指定 `utf-8` 编码, 发送不同格式的文件对应不同的响应头, 可以参考以下网址:

*[常用对照表](https://tool.oschina.net/commons)*

## 六. Node 中的 JavaScript

### 1. 核心模块

Node.js 为 JavaScript 提供了很多服务器级别的 API. 这些 API 绝大多数都被包装到了一个具名的核心模块中了.

例如: 

- 文件操作 => fs 模块
- http 服务 => http 模块
- 路径操作 => path 模块
- 操作系统信息 => os 模块

### 2. 用户自定义模块

- 从外部引入 => `require`

- 导出到外部 => `exports`

新建两个文件: `main.js` 和 `a.js`, 目标在 `main.js` 中引用外部 js 文件.

`main.js`代码如下:

```js
console.log('主函数开始执行');

// 引入本目录下的 a.js 文件, 拓展名可省略
var aRequire = require('./a')

// 打印 a.js 中 exports 的 add 方法的结果
console.log(aRequire.add(1, 2));

console.log('主函数结束执行');
```

`a.js` 代码如下:

```js
console.log('现在执行 a.js');

// 定义一个 add 函数
var add = function (a, b)  {  
  return a + b;
}

// 将 add 函数挂载到 exports 上
exports.add = add

console.log('结束执行 a.js');
```

在命令行中执行 `main.js` 文件, 结果如下:

```powershell
PS F:\Software\Node.js\Node.js-Learning-Repository\src\2020-1-30\require> node .\main.js
主函数开始执行
现在执行 a.js 
结束执行 a.js 
3
主函数结束执行
```













 